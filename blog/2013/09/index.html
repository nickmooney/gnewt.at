<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
<title>  2013  September | Gnewt&#039;s Blag</title>
<meta name="description" content="Weekend Project: Web-controlled Christmas Lights with Node.js, Arduino, and Raspberry Pi" />
<link rel="alternate" type="application/rss+xml" title="Gnewt&#039;s Blag RSS Feed" href="../../feed/index.html" />
<link rel="alternate" type="application/atom+xml" title="Gnewt&#039;s Blag Atom Feed" href="../../feed/atom/index.html" /> 
<link rel="pingback" href="http://www.gnewt.at/blog/xmlrpc.php" />

<link rel="stylesheet" href="../../wp-content/themes/monochrome/style.css" type="text/css" />
<link rel="stylesheet" href="../../wp-content/themes/monochrome/comment-style.css" type="text/css" />
<!--[if lt IE 7]>
<link rel="stylesheet" href="http://www.gnewt.at/blog/wp-content/themes/monochrome/ie6.css" type="text/css" />
<![endif]--> 
<style type="text/css">
.post img, .post a img { border:1px solid #ccc; padding:5px; margin:0 10px 0 0;  background:#f2f2f2; }
.post a:hover img { border:1px solid #38a1e5; background:#9cd1e1; }
.post img.wp-smiley { border:0px; padding:0px; margin:0px; background:none; }
</style>

 
<link rel='dns-prefetch' href='http://s.w.org/' />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.gnewt.at\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),!(j.toDataURL().length<3e3)&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,65039,8205,55356,57096),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,55356,57096),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55357,56425,55356,57341,8205,55357,56507),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55357,56425,55356,57341,55357,56507),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<!-- This site uses the Google Analytics by MonsterInsights plugin v5.5.4 - Universal enabled - https://www.monsterinsights.com/ -->
<script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

	__gaTracker('create', 'UA-32955882-1', 'auto');
	__gaTracker('set', 'forceSSL', true);
	__gaTracker('send','pageview');

</script>
<!-- / Google Analytics by MonsterInsights -->
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery.js%3Fver=1.12.4'></script>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery-migrate.min.js%3Fver=1.4.1'></script>
<link rel='https://api.w.org/' href='../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.7.2" />
<style type="text/css" id="syntaxhighlighteranchor"></style>
<script type="text/javascript" src="../../wp-content/themes/monochrome/js/scroll.js"></script>
<script type="text/javascript" src="../../wp-content/themes/monochrome/js/jscript.js"></script>
<script type="text/javascript" src="../../wp-content/themes/monochrome/js/comment.js"></script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-15905622-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</head>

<body>
<div id="wrapper">

 <div id="header">

  <div id="header_top">

   <div id="logo">
       <a href="../../../index.html">Gnewt&#039;s Blag</a>
    <h1>She turned me into a Gnewt! I got better&#8230;</h1>
      </div>

      <div class="header_menu">
    <ul class="menu">
     <li class="page_item"><a href="../../../index.html">HOME</a></li>
     <li class="page_item page-item-2"><a href="../../index.html%3Fp=2.html">/usr/bin/whoami</a></li>
    </ul>
   </div>
   
  </div>

  </div><!-- #header end -->  <div id="contents" class="clearfix">

   <div id="left_col">


    <div id="header_meta">

          <p>Archive for <span id="keyword">September, 2013</span></p>

     
    </div><!-- #header_meta end -->


    <div class="post_odd">
     <div class="post clearfix">
      <div class="post_content_wrapper">
       <h2 class="post_title"><a href="../../index.html%3Fp=250.html">Weekend Project: Web-controlled Christmas Lights with Node.js, Arduino, and Raspberry Pi</a></h2>
       <div class="post_content">
        <p><a href="../../wp-content/uploads/2013/09/christmaslights.jpg"><img class="aligncenter size-medium wp-image-255" alt="Christmas Lights" src="../../wp-content/uploads/2013/09/christmaslights-300x199.jpg" width="300" height="199" srcset="http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights-300x199.jpg 300w, http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights-1024x680.jpg 1024w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>This is my Node.js &#8220;hello world.&#8221; It&#8217;s a weekend project that allows you to control GE Color Effects lights over the internet through the use of a Raspberry Pi (running nginx and a Node.js application) connected to an Arduino. Like I say in the video, I think it may be possible to control the data line of these lights directly from the Raspberry Pi&#8217;s GPIO pins, but I <a href="https://github.com/Gnewt/circular-christmas-lights" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://github.com/Gnewt/circular-christmas-lights', 'already wrote an Arduino library');">already wrote an Arduino library</a>Â to handle that and it works nicely.</p>
<p><iframe width="500" height="375" src="http://www.youtube.com/embed/NFm5xcVaPGo?feature=oembed" frameborder="0" allowfullscreen></iframe></p>
<h2>Tech Stuff</h2>
<p>The setup is fairly simple. The Raspberry Pi runs a frontend with my webserver of choice, nginx. It serves up a static page on / and proxies to my Node.js application on /api. Post data sent to /api is decoded by the Node application and matched with a hex value (assuming the color sent was valid). This hex value is then packed into the two-byte serial format I developed for my Arduino library, and sent over serial to the Arduino. Internally the Arduino uses a data structure called a <a href="http://en.wikipedia.org/wiki/Circular_buffer" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://en.wikipedia.org/wiki/Circular_buffer', 'circular buffer');">circular buffer</a>. Circular buffers are especially cool for this usage, because when I &#8216;push&#8217; a light onto the string of lights, every single light needs to be updated (as each color is &#8216;moving&#8217; down the line). With a circular buffer, the data structure remains a constant size, and all that&#8217;s required to update it is to write a new value at the &#8216;head&#8217; location and then increment the location of the head. More specifics about how this works can be found in the linked Wikipedia article as well as the source code for the aforementioned Arduino library.</p>
<p>I had a lot of fun with this project. One thing I really like about Node.js is how simple it makes creating APIs that can do Really Cool Things. Using just the JavaScript environment available in my web browser, I can package the color data in the format Node needs it, and let Node handle the rest. Node.js is not for everything, but the ease of communication between browser and application makes it a joy to work with.</p>
<h2>Do It Yourself</h2>
<p>Get a Raspberry Pi set up with Node.js installed, and an Arduino with the sketch linked below flashed to it. To flash the Arduino, you need the <a href="http://www.digitalmisery.com/2011/11/ge-color-effects-arduino-library/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.digitalmisery.com/2011/11/ge-color-effects-arduino-library/', 'GEColorEffects library');">GEColorEffects library</a> as a dependency. Â Connection to the lights themselves is outside of the scope of this post, but more info can be found in <a href="http://www.deepdarc.com/2010/11/27/hacking-christmas-lights/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.deepdarc.com/2010/11/27/hacking-christmas-lights/', 'darco&#8217;s original post');">darco&#8217;s original post</a>. Clone the nodejs-christmas-lights git repository onto the Raspberry Pi. Ensure that the Arduino manifests as a serial port (usually /dev/ttyACM0) on the RPi, and chmod it to be accessible by your user. A simple &#8216;chmod 777 /dev/ttyACM0&#8217; should do, since (hopefully&#8230;) your Raspberry Pi isn&#8217;t a production box.</p>
<p>Set up nginx on your Raspberry Pi, and put the contents of the nodejs-christmas-lights repository&#8217;s www folder in your webroot. Again, this is more or less outside the scope of this post, but the following config should act as a starting point. Important to note is that the /api path must forward to the host/port of your Node.js application.</p>
<pre>server {
    listen 80;
    server_name lights;

    root /var/www/vhosts/lights/htdocs;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    location /api {
        proxy_pass http://localhost:8080;
    }
}</pre>
<p>If all is set up correctly, navigate to the Raspberry Pi in your browser, choose a color, and hit the &#8216;Go!&#8217; button.</p>
<h2>Resources</h2>
<ul>
<li>Circular Buffer Christmas Lights (Arduino sketch): <a href="https://github.com/Gnewt/circular-christmas-lights" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://github.com/Gnewt/circular-christmas-lights', 'Github');">Github</a></li>
<li>GE Color Effects library: <a href="http://www.digitalmisery.com/2011/11/ge-color-effects-arduino-library/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.digitalmisery.com/2011/11/ge-color-effects-arduino-library/', 'GE Color Effects Arduino Library');">GE Color Effects Arduino Library</a></li>
<li>Node.js Christmas Lights: <a href="https://github.com/Gnewt/nodejs-christmas-lights" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://github.com/Gnewt/nodejs-christmas-lights', 'Github');">Github</a></li>
<li>Darco&#8217;s original post: <a href="http://www.deepdarc.com/2010/11/27/hacking-christmas-lights/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.deepdarc.com/2010/11/27/hacking-christmas-lights/', 'Hacking Christmas Lights');">Hacking Christmas Lights</a></li>
</ul>
<p>Feel free to ask questions in the comments. If you do something cool with this code, I&#8217;d love to hear about it!</p>
       </div>
      </div>
      <dl class="post_meta">
        <dt class="meta_date">2013</dt>
         <dd class="post_date">09<span>/15</span></dd>
                <dt>CATEGORY</dt>
         <dd><a href="../../category/code/index.html" rel="category tag">Code</a></dd>
                 <dt>TAGS</dt><dd><a href="../../tag/arduino/index.html" rel="tag">arduino</a><br /><a href="../../tag/christmas-lights/index.html" rel="tag">christmas lights</a><br /><a href="../../tag/node-js/index.html" rel="tag">node.js</a><br /><a href="../../tag/raspberry-pi/index.html" rel="tag">raspberry pi</a></dd>                <dt class="meta_comment"><a href="../../index.html%3Fp=250.html#comments"><span class="dsq-postid" data-dsqidentifier="250 http://www.gnewt.at/blog/?p=250">5 comments</span></a></dt>
               </dl>
     </div>
    </div>


    <div class="content_noside">
     <div class="page_navi clearfix">

</div>
    </div>

   </div><!-- #left_col end -->

   <div id="right_col">
  
    <div id="information_area" class="clearfix">
   <div class="side_box" id="information">
    <h3>Information</h3>
    <div id="information_contents">I'm Gnewt and I make things.</div>
   </div>
      <div id="entries_rss">
    <a href="../../feed/index.html" title="Entries RSS" >RSS FEED</a>
   </div>
     </div>
  
    <div class="side_box" id="search_area_top">
   <div id="search_area" class="clearfix">
        <form method="get" id="searchform" action="../../../index.html">
     <div><input type="text" value="Search" name="s" id="search_input" onfocus="this.value=''; changefc('white');" /></div>
     <div><input type="image" src="../../wp-content/themes/monochrome/img/search_button.gif" alt="Search from this blog." title="Search from this blog." id="search_button" /></div>
    </form>
       </div>
     </div>
  
  
   <div class="side_box">
   <h3>Recent entry</h3>
    <ul>
     <li class="side_date">2014-04-14</li>
     <li><a href="../../index.html%3Fp=291.html">BHS Shirt Sales with Django</a></li>
     <li class="side_date">2014-01-14</li>
     <li><a href="../../index.html%3Fp=276.html">What Would the Bhagavad Gita Say?</a></li>
     <li class="side_date">2013-09-15</li>
     <li><a href="../../index.html%3Fp=250.html">Weekend Project: Web-controlled Christmas Lights with Node.js, Arduino, and Raspberry Pi</a></li>
     <li class="side_date">2013-08-18</li>
     <li><a href="../../index.html%3Fp=244.html">Publishing Data to Redis with Django Signals</a></li>
     <li class="side_date">2012-07-13</li>
     <li><a href="../../index.html%3Fp=235.html">Scripting an Ice Cream Delivery with the Android SDK</a></li>
   </ul>
  </div>

   <div class="side_box">
   <h3>Archive</h3>
   <ul>
    	<li><a href='../../2014/04/index.html'>April 2014</a></li>
	<li><a href='../../2014/01/index.html'>January 2014</a></li>
	<li><a href='index.html'>September 2013</a></li>
	<li><a href='../08/index.html'>August 2013</a></li>
	<li><a href='../../2012/07/index.html'>July 2012</a></li>
	<li><a href='../../2012/06/index.html'>June 2012</a></li>
	<li><a href='../../2011/05/index.html'>May 2011</a></li>
	<li><a href='../../2010/05/index.html'>May 2010</a></li>
	<li><a href='../../2010/04/index.html'>April 2010</a></li>
	<li><a href='../../2009/10/index.html'>October 2009</a></li>
	<li><a href='../../2009/03/index.html'>March 2009</a></li>
   </ul>
   </div>

   <div class="side_box">
   <h3>Category</h3>
   <ul>
    	<li class="cat-item cat-item-23"><a href="../../category/code/index.html" >Code</a>
</li>
	<li class="cat-item cat-item-1"><a href="../../category/uncategorized/index.html" >Uncategorized</a>
</li>
   </ul>
   </div>


  
</div><!-- #right_col end -->
  </div><!-- #contents end -->

  <div id="footer">
   <ul id="copyright">
    <li style="background:none;">
                Copyright &copy;&nbsp; 2009-2017     &nbsp;<a href="../../../index.html">Gnewt&#039;s Blag</a></li>
    <li><a href="http://www.mono-lab.net/">Theme designed by mono-lab</a></li>
    <li><a href="http://wordpress.org/">Powered by WordPress</a></li>
   </ul>
  </div>
 
</div><!-- #wrapper end -->

<div id="return_top">
 <a href="index.html#wrapper">&nbsp;</a>
</div>

<script type='text/javascript' src='../../wp-includes/js/wp-embed.min.js%3Fver=4.7.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"gnewt"};
/* ]]> */
</script>
<script type='text/javascript' src='../../wp-content/plugins/disqus-comment-system/media/js/count.js%3Fver=4.7.2'></script>
</body>
</html>
<!-- Dynamic page generated in 0.054 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2017-02-01 13:12:34 -->
