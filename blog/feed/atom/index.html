<?xml version="1.0" encoding="UTF-8"?><feed
  xmlns="http://www.w3.org/2005/Atom"
  xmlns:thr="http://purl.org/syndication/thread/1.0"
  xml:lang="en-US"
  xml:base="http://www.gnewt.at/blog/wp-atom.php"
   >
	<title type="text">Gnewt&#039;s Blag</title>
	<subtitle type="text">She turned me into a Gnewt! I got better...</subtitle>

	<updated>2014-04-14T16:59:55Z</updated>

	<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog" />
	<id>http://www.gnewt.at/blog/feed/atom/</id>
	<link rel="self" type="application/atom+xml" href="http://www.gnewt.at/blog/feed/atom/" />

	<generator uri="https://wordpress.org/" version="4.7.2">WordPress</generator>
	<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[BHS Shirt Sales with Django]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2014/04/bhs-shirt-sales-with-django/" />
		<id>http://www.gnewt.at/blog/?p=291</id>
		<updated>2014-04-14T16:59:55Z</updated>
		<published>2014-04-14T16:59:41Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Code" />		<summary type="html"><![CDATA[This is a project I&#8217;ve been working on for the past week or so. It&#8217;s live now, and I wanted to share the codebase. This post is more or less exactly the README from the GitHub repo bhs_sales, so head there if you want to get right to it. Intro The BHS Class of 2014 [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2014/04/bhs-shirt-sales-with-django/"><![CDATA[<p>This is a project I&#8217;ve been working on for the past week or so. It&#8217;s live now, and I wanted to share the codebase. This post is more or less exactly the README from the <a href="https://github.com/Gnewt/bhs_sales">GitHub repo bhs_sales</a>, so head there if you want to get right to it.</p>
<h2>Intro</h2>
<p>The BHS Class of 2014 needs some money for prom. We came up with the idea of selling senior shirts as a fundraiser, but the process for organizing an order for ~300 people is incredibly complex and comes with the headaches of having to lend money to make an order, collecting money afterward, over-ordering, etc.</p>
<p>This is our solution: a Stripe-based marketplace to preorder shirts. This lets us record the name/size/selection of everyone who wants a shirt, and then aggregate that data later. Payments are processed through Stripe.</p>
<h2>Technical Stuff</h2>
<p>This is a Django project. It currently only has one application, &#8220;shirts.&#8221; Data is stored by default in SQLite, but that can be changed easily. Database migrations are handled through South.</p>
<p>I have included some deployment scripts, namely:</p>
<ul>
<li><code>Makefile</code>
<ul>
<li>Provides automated deployment, but will require changing of paths</li>
</ul>
</li>
<li><code>hup_bhssales</code>
<ul>
<li>Used in my git post-receive hook to restart the server process automatically when I push new changes to production</li>
</ul>
</li>
<li><code>bin/gunicorn_start</code>
<ul>
<li>The script called by supervisord to start gunicorn &#8212; will also require changing of paths for custom deployment</li>
</ul>
</li>
</ul>
<p>Supervisor keeps a gunicorn instance running with a socket in /tmp. I have set up nginx to proxy_pass to that socket, more or less just like any other Django project.</p>
<h2>Architecture</h2>
<p>There are only two models. 1. <code>StoreItem</code> contains a name/description/summary/price of a certain item 2. <code>Order</code> contains the name of the customer, a timestamp, the purchase price (in case the price in the future changes), and the Stripe ID of the charge. The Stripe ID is optional &#8212; I&#8217;ve allowed a separate &#8220;in person&#8221; payment type.</p>
<p>When the order form is submitted, <code>/charge</code> will use the Stripe Checkout token to attempt to make the charge through Stripe. If it&#8217;s successful, an Order instance will be saved and the user redirected to a confirmation page. A public list of all orders is included.</p>
<p>The sizes are stored as a constant in <code>shirts/models.py</code>. I&#8217;m not sure this is the best way to do it.</p>
<h2>Configuration</h2>
<p>I have included my Dev configuration. I manage configurations using <a href="http://django-configurations.readthedocs.org/en/latest/">django-configurations</a>. You&#8217;ll notice the end of <code>settings.py</code> tries to import all from <code>local_settings.py</code>. You&#8217;ll need to create a <code>local_settings.py</code> in the same format as <code>settings.py</code>, containing a:</p>
<pre><code>class Production(Configuration):
</code></pre>
<p>Put your live Stripe keys in that configuration, without committing it to Git.</p>
<p>Also, run this in a venv. A <code>requirements.txt</code> is included.</p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2014/04/bhs-shirt-sales-with-django/#comments" thr:count="1"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2014/04/bhs-shirt-sales-with-django/feed/atom/" thr:count="1"/>
		<thr:total>1</thr:total>
		</entry>
		<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[What Would the Bhagavad Gita Say?]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2014/01/what-would-the-bhagavad-gita-say-2/" />
		<id>http://www.gnewt.at/blog/?p=276</id>
		<updated>2014-01-15T02:34:40Z</updated>
		<published>2014-01-15T02:34:40Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Uncategorized" />		<summary type="html"><![CDATA[Note: I wrote this post in Ghost originally, check it out! This year I&#8217;m in a Humanities class. To finalize the semester, each student presents a &#8220;Creative Project.&#8221; The project includes a 10-15 line recitation from one of the texts we&#8217;ve read, a supplement (art piece, sculpture, song, dance, etc.), and a 5-7 minutes talk. [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2014/01/what-would-the-bhagavad-gita-say-2/"><![CDATA[<p><strong>Note: <a href="http://ghost.gnewt.at/what-would-the-bhagavad-gita-say/">I wrote this post in Ghost originally, check it out!</a></strong></p>
<p><img src="http://www.gnewt.at/blog/wp-content/uploads/2014/01/Screenshot-2014-01-14-18.01.32-300x210.png" alt="You are the evil" /></p>
<p>This year I&#8217;m in a Humanities class. To finalize the semester, each student presents a &#8220;Creative Project.&#8221; The project includes a 10-15 line recitation from one of the texts we&#8217;ve read, a supplement (art piece, sculpture, song, dance, etc.), and a 5-7 minutes talk.</p>
<p>I&#8217;m reciting a passage from the <a href="http://en.wikipedia.org/wiki/Bhagavad_Gita">Bhagavad Gita</a> and was at a loss of what to include as a supplement until I remembered <a href="http://what-would-i-say.com">What Would I Say</a>.</p>
<p><a href="http://what-would-i-say.com">What Would I Say</a> is a project by HackPrinceton which creates a <a href="http://en.wikipedia.org/wiki/Markov_chain">Markov chain</a> from your Facebook statuses and uses it to generate sentences that sound like you. The results are &#8220;often hilarious (and sometimes nonsensical).&#8221; I decided that as my supplement I wanted to create a Markov chain of the Bhagavad Gita, the goal being to generate phrases that sound like they were pulled from the text but really make little to no sense. This ended up being easier than I expected. Steps are as follows.</p>
<ul>
<li>Extract the text from the Bhagavad Gita into plaintext
<ul>
<li>I had a PDF copy so extracting <em>just</em> the text was tough, but after half an hour or so of regular expressions and manual editing, it was fine</li>
</ul>
</li>
<li>Create a Markov chain from the result
<ul>
<li>I used codebox&#8217;s <a href="https://github.com/codebox/markov-text">markov-chain project</a> from GitHub</li>
<li>I initially only generated the chain with a depth of 3, but added chains of depth 2 and 4 later &#8212; depth 2 produces far more disjointed and ridiculous sentences, depth 4 produces almost verbatim sentences with occasional changes</li>
</ul>
</li>
<li>Get a nice template
<ul>
<li>Shamelessly copied from What Would I Say</li>
</ul>
</li>
<li>Programatically make random sentences available through an API
<ul>
<li>I modified the markov-chain project slightly and put it inside a <a href="http://flask.pocoo.org/">Flask</a> wrapper</li>
</ul>
</li>
<li>Write some JavaScript to grab new results from the API when the big button is clicked</li>
</ul>
<p>That&#8217;s it! The final result can be seen at <a href="http://instantgita.com">instantgita.com</a> and works pretty nicely. The Markov chain depth defaults to 3, but it&#8217;s worth playing with 2 and 4 as well.</p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2014/01/what-would-the-bhagavad-gita-say-2/#comments" thr:count="0"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2014/01/what-would-the-bhagavad-gita-say-2/feed/atom/" thr:count="0"/>
		<thr:total>0</thr:total>
		</entry>
		<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[Weekend Project: Web-controlled Christmas Lights with Node.js, Arduino, and Raspberry Pi]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2013/09/christmas-lights-with-node-js-arduino-raspberry-pi/" />
		<id>http://www.gnewt.at/blog/?p=250</id>
		<updated>2013-09-15T20:19:51Z</updated>
		<published>2013-09-15T20:03:38Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Code" /><category scheme="http://www.gnewt.at/blog" term="arduino" /><category scheme="http://www.gnewt.at/blog" term="christmas lights" /><category scheme="http://www.gnewt.at/blog" term="node.js" /><category scheme="http://www.gnewt.at/blog" term="raspberry pi" />		<summary type="html"><![CDATA[This is my Node.js &#8220;hello world.&#8221; It&#8217;s a weekend project that allows you to control GE Color Effects lights over the internet through the use of a Raspberry Pi (running nginx and a Node.js application) connected to an Arduino. Like I say in the video, I think it may be possible to control the data [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2013/09/christmas-lights-with-node-js-arduino-raspberry-pi/"><![CDATA[<p><a href="http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights.jpg"><img class="aligncenter size-medium wp-image-255" alt="Christmas Lights" src="http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights-300x199.jpg" width="300" height="199" srcset="http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights-300x199.jpg 300w, http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights-1024x680.jpg 1024w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>This is my Node.js &#8220;hello world.&#8221; It&#8217;s a weekend project that allows you to control GE Color Effects lights over the internet through the use of a Raspberry Pi (running nginx and a Node.js application) connected to an Arduino. Like I say in the video, I think it may be possible to control the data line of these lights directly from the Raspberry Pi&#8217;s GPIO pins, but I <a href="https://github.com/Gnewt/circular-christmas-lights">already wrote an Arduino library</a> to handle that and it works nicely.</p>
<p><iframe width="500" height="375" src="http://www.youtube.com/embed/NFm5xcVaPGo?feature=oembed" frameborder="0" allowfullscreen></iframe></p>
<h2>Tech Stuff</h2>
<p>The setup is fairly simple. The Raspberry Pi runs a frontend with my webserver of choice, nginx. It serves up a static page on / and proxies to my Node.js application on /api. Post data sent to /api is decoded by the Node application and matched with a hex value (assuming the color sent was valid). This hex value is then packed into the two-byte serial format I developed for my Arduino library, and sent over serial to the Arduino. Internally the Arduino uses a data structure called a <a href="http://en.wikipedia.org/wiki/Circular_buffer">circular buffer</a>. Circular buffers are especially cool for this usage, because when I &#8216;push&#8217; a light onto the string of lights, every single light needs to be updated (as each color is &#8216;moving&#8217; down the line). With a circular buffer, the data structure remains a constant size, and all that&#8217;s required to update it is to write a new value at the &#8216;head&#8217; location and then increment the location of the head. More specifics about how this works can be found in the linked Wikipedia article as well as the source code for the aforementioned Arduino library.</p>
<p>I had a lot of fun with this project. One thing I really like about Node.js is how simple it makes creating APIs that can do Really Cool Things. Using just the JavaScript environment available in my web browser, I can package the color data in the format Node needs it, and let Node handle the rest. Node.js is not for everything, but the ease of communication between browser and application makes it a joy to work with.</p>
<h2>Do It Yourself</h2>
<p>Get a Raspberry Pi set up with Node.js installed, and an Arduino with the sketch linked below flashed to it. To flash the Arduino, you need the <a href="http://www.digitalmisery.com/2011/11/ge-color-effects-arduino-library/">GEColorEffects library</a> as a dependency.  Connection to the lights themselves is outside of the scope of this post, but more info can be found in <a href="http://www.deepdarc.com/2010/11/27/hacking-christmas-lights/">darco&#8217;s original post</a>. Clone the nodejs-christmas-lights git repository onto the Raspberry Pi. Ensure that the Arduino manifests as a serial port (usually /dev/ttyACM0) on the RPi, and chmod it to be accessible by your user. A simple &#8216;chmod 777 /dev/ttyACM0&#8217; should do, since (hopefully&#8230;) your Raspberry Pi isn&#8217;t a production box.</p>
<p>Set up nginx on your Raspberry Pi, and put the contents of the nodejs-christmas-lights repository&#8217;s www folder in your webroot. Again, this is more or less outside the scope of this post, but the following config should act as a starting point. Important to note is that the /api path must forward to the host/port of your Node.js application.</p>
<pre>server {
    listen 80;
    server_name lights;

    root /var/www/vhosts/lights/htdocs;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    location /api {
        proxy_pass http://localhost:8080;
    }
}</pre>
<p>If all is set up correctly, navigate to the Raspberry Pi in your browser, choose a color, and hit the &#8216;Go!&#8217; button.</p>
<h2>Resources</h2>
<ul>
<li>Circular Buffer Christmas Lights (Arduino sketch): <a href="https://github.com/Gnewt/circular-christmas-lights">Github</a></li>
<li>GE Color Effects library: <a href="http://www.digitalmisery.com/2011/11/ge-color-effects-arduino-library/">GE Color Effects Arduino Library</a></li>
<li>Node.js Christmas Lights: <a href="https://github.com/Gnewt/nodejs-christmas-lights">Github</a></li>
<li>Darco&#8217;s original post: <a href="http://www.deepdarc.com/2010/11/27/hacking-christmas-lights/">Hacking Christmas Lights</a></li>
</ul>
<p>Feel free to ask questions in the comments. If you do something cool with this code, I&#8217;d love to hear about it!</p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2013/09/christmas-lights-with-node-js-arduino-raspberry-pi/#comments" thr:count="5"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2013/09/christmas-lights-with-node-js-arduino-raspberry-pi/feed/atom/" thr:count="5"/>
		<thr:total>5</thr:total>
		</entry>
		<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[Publishing Data to Redis with Django Signals]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2013/08/publishing-data-to-redis-with-django-signals/" />
		<id>http://www.gnewt.at/blog/?p=244</id>
		<updated>2013-08-19T04:37:29Z</updated>
		<published>2013-08-19T04:37:29Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Code" />		<summary type="html"><![CDATA[Just something I found and thought was kind of cool. I&#8217;m currently working on a project that uses Django for its frontend, but eventually passes the user to a JavaScript frontend that talks to the Node.js / Redis backend with Socket.IO. I needed a way to store data in Redis whenever a specific Django model [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2013/08/publishing-data-to-redis-with-django-signals/"><![CDATA[<p>Just something I found and thought was kind of cool. I&#8217;m currently working on a project that uses Django for its frontend, but eventually passes the user to a JavaScript frontend that talks to the Node.js / Redis backend with Socket.IO. I needed a way to store data in Redis whenever a specific Django model was saved. I looked up &#8216;Django + redis&#8217; beforehand, but the existing projects seem to be mostly cache-oriented, and as far as I know Django doesn&#8217;t have a standard adapter for Redis. No worries &#8212; it&#8217;s all Python!</p>
<p>Django signals let you execute functions whenever a signal is emitted, but specifically in my case, when a model is saved. You can put your signals code anywhere, but I like to make a &#8216;signals.py&#8217; in the app directory and then just add the line &#8216;import signals&#8217; to the app&#8217;s __init__.py. I subscribed to the Django model saved and model deleted signals with functions that connect to Redis and add some of the relevant data to a hash. Hashes in Redis are very much like dicts in Python, and <a href="https://github.com/andymccurdy/redis-py">Andy McCurdy&#8217;s redis-py library</a> allows you to pass dicts directly to the hmset function.</p>
<p>Here&#8217;s the relevant code (adapted for the example) in signals.py:</p>
<pre class="brush: python; title: ; notranslate">import redis
from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver
from yourapp.models import YourModel

@receiver(post_save, sender=YourModel, dispatch_uid=&quot;yourmodel_create&quot;)
def addYourModelToRedis(sender, instance, **kwargs):
	r = redis.StrictRedis(host='localhost', port=6379, db=0)
	yourmodel_dict = {
		'uid': instance.user.id,
		'number1': instance.number_1,
		'number2': instance.number_2,
		'status': instance.status
	}
	r.hmset('yourmodel:' + instance.uniqueKey, yourmodel_dict)

@receiver(post_delete, sender=YourModel, dispatch_uid=&quot;yourmodel_delete&quot;)
def removeYourModelFromRedis(sender, instance, **kwargs):
	r = redis.StrictRedis(host='localhost', port=6379, db=0)
	r.delete('yourmodel:' + instance.uniqueKey)</pre>
<p>The &#8220;dispatch_uid&#8221; parameter passed to the receiver decorator is intended to keep the signal from being acted upon more than once per save/deletion of a model. All the Django documentation says is to use a unique string; they don&#8217;t recommend that you use a specific format and it doesn&#8217;t seem to matter as long as it&#8217;s unique. Another thing to note is that the &#8216;instance&#8217; parameter for my handler functions is specific to the post_save and post_delete signals. In general signal handlers are expected to take &#8220;sender&#8221; and &#8220;**kwargs.&#8221; However it&#8217;s safe to extract the &#8216;instance&#8217; variable from **kwargs in the function definition when only being used for these specific signals. More information about signals and handling signals can be found in the <a href="https://docs.djangoproject.com/en/dev/topics/signals/">Django documentation.</a></p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2013/08/publishing-data-to-redis-with-django-signals/#comments" thr:count="0"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2013/08/publishing-data-to-redis-with-django-signals/feed/atom/" thr:count="0"/>
		<thr:total>0</thr:total>
		</entry>
		<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[Scripting an Ice Cream Delivery with the Android SDK]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2012/07/scripting-an-ice-cream-delivery-with-the-android-sdk/" />
		<id>http://www.gnewt.at/blog/?p=235</id>
		<updated>2012-07-13T23:18:18Z</updated>
		<published>2012-07-13T23:15:20Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Uncategorized" />		<summary type="html"><![CDATA[Today, a smartphone-connected taxi company called Uber is operating five ice cream trucks in Seattle. You click a button in the Uber app and select your location, and an ice cream truck comes to you. Or at least that&#8217;s what should happen. Even with today&#8217;s weather (read: periodic torrential rain), people are clamoring to get their [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2012/07/scripting-an-ice-cream-delivery-with-the-android-sdk/"><![CDATA[<p>Today, a smartphone-connected taxi company called <a href="https://www.uber.com/">Uber</a> is operating five ice cream trucks in Seattle. You click a button in the Uber app and select your location, and an ice cream truck comes to you. Or at least that&#8217;s what should happen. Even with today&#8217;s weather (read: periodic torrential rain), people are clamoring to get their ice cream due to the fact that it&#8217;s only available for one day&#8230; meaning almost nobody is actually able to get a spot in the queue. Uber&#8217;s Twitter feed is full of advice telling customers just keep hitting the button, but man, I have work to do. I can&#8217;t sit here and press the little ice cream icon all day. Something has got to give.</p>
<p><img class="aligncenter" src="http://i.imgur.com/2Bt6zl.png" alt="" width="360" height="640" /></p>
<p>The Android SDK contains a tool called <a href="http://developer.android.com/tools/help/monkeyrunner_concepts.html">monkeyrunner</a>. Monkeyrunner lets you simulate touch events, take screenshots, etc&#8230; and it does it through a very simple Python library. I decided to see if I could write a little script to keep pressing the ice cream button in Uber&#8217;s app, and it only took a few minutes.</p>
<pre class="brush: python; title: ; notranslate">from time import sleep
from com.android.monkeyrunner import MonkeyRunner, MonkeyDevice

# Attach to Android device
d = MonkeyRunner.waitForConnection()

# Take a screenshot of the &quot;sorry, keep trying&quot; screen for reference
raw_input(&quot;Get to the error screen, then hit enter.\n&quot;)
oldpic = d.takeSnapshot()

while True:
    # Touch the ice cream button
    d.touch(540, 200, MonkeyDevice.DOWN_AND_UP)
    sleep(4)
    newpic = d.takeSnapshot()
	# If the screen looks like our old error
	# screen (95%), hit OK and just keep going (in 10 seconds)
    if newpic.sameAs(oldpic, .95):
        d.touch(460, 700, MonkeyDevice.DOWN_AND_UP)
        sleep(10)
	# But if the screen has changed, stop running the loop.
    else:
		break
</pre>
<p>I still don&#8217;t have ice cream, but the script is running and working.</p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2012/07/scripting-an-ice-cream-delivery-with-the-android-sdk/#comments" thr:count="4"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2012/07/scripting-an-ice-cream-delivery-with-the-android-sdk/feed/atom/" thr:count="4"/>
		<thr:total>4</thr:total>
		</entry>
		<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[Bi-directional Caller ID Spoofing with Asterisk]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2012/07/asterisk-bidirectional-cid-spoofing/" />
		<id>http://www.gnewt.at/blog/?p=225</id>
		<updated>2012-07-04T02:04:20Z</updated>
		<published>2012-07-04T02:04:20Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Uncategorized" />		<summary type="html"><![CDATA[Caller ID spoofing has been around for a long time. Way back when (well, 2004), an article was published on rootsecure.net with an included Perl script, detailing how to use Asterisk to change your caller ID information, in order to pretend to be somebody else. I had some fun toying with that (heh...), and noticed [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2012/07/asterisk-bidirectional-cid-spoofing/"><![CDATA[<p>Caller ID spoofing has been around for a long time. Way back when (well, 2004), an <a href="http://www.rootsecure.net/?p=reports/callerid_spoofing">article</a> was published on rootsecure.net with an included Perl script, detailing how to use Asterisk to change your caller ID information, in order to pretend to be somebody else. I had some fun toying with that (<a href="http://vimeo.com/4420607">heh.</a>..), and noticed that some commercial services began to pop up which offered the same capability for a price. SpoofCard is the one that I&#8217;ve seen around the most, but many exist. Bah. Setting up an Asterisk server is free if you have access to a Linux box, and outbound SIP trunking is dead cheap. With flowroute.com, I pay less than a cent per minute to place calls within the U.S. The perl script, obviously, is also free.</p>
<p>The other day I saw something as part of a commercial spoofing service that I hadn&#8217;t seen before: <a href="http://www.prankdial.com/pranks/eviloperator">bidirectional caller ID spoofing</a>. Basically, it will call friend A from friend B&#8217;s number, friend B from friend A&#8217;s number, and record the result. This leads to something along the lines of &#8220;You called me!&#8221; &#8220;No, you called me!&#8221; As fun as that is, websites like PrankDial are charging a lot of money to do something that is, in practice, very simple.</p>
<p>I haven&#8217;t seen a script to do this posted on the internet yet, so I created one and <a href="https://github.com/Gnewt/asterisk-dual-cid-spoof">put it on github</a>. You&#8217;ll have to set up the Asterisk server by yourself, but implementing the script is easy.</p>
<ol>
<li>Put dual_cid_spoof.py in the /usr/share/asterisk/agi-bin directory</li>
<li>Make it executable to the asterisk user</li>
<li>Add an extension to extensions.conf that calls the script, using pattern matching to give it arguments. For example:</li>
</ol>
<pre>[spoof]
exten =&gt; _37NXXNXXXXXXNXXNXXXXXX,1,Answer
exten =&gt; _37NXXNXXXXXXNXXNXXXXXX,2,AGI(dualcidspoof.py,${EXTEN:2:10},${EXTEN:12:10})</pre>
<p>This uses the extension 37, but that part can be changed. This pattern matches any calls that have the number 37 followed by two 10-digit phone numbers, and then pulls those numbers out and uses them as arguments to the AGI script ${EXTEN:2:10} means take the extension, at index 2, and pull out 10 digits. To execute it with phone numbers 123-123-1111 and 222-202-2020, I would dial 3712312311112222022020.</p>
<p><a href="http://www.voip-info.org/wiki/view/Asterisk+cmd+MeetMe">MeetMe</a> is required to use this script, since it works by placing both users into a conference room together. The default conference room number is 1234, but that can be changed in the script. Also necessary is changing the outgoing SIP trunk in the Python script from &#8220;flowroute&#8221; to whatever the name of your outgoing SIP trunk is. Both of these are variables at the top of the script. Execution flow works like this:</p>
<ul>
<li>Create two .call files, each with opposite CID/destination info. These files are set to dump the callees into a conference room when they answer.</li>
<li>Place the files in /var/spool/outgoing/asterisk, to be automatically processed by the Asterisk spooler.</li>
<li>Connect you into the same conference room as a muted admin, giving you the ability to kick users and listen without being heard.</li>
</ul>
<p>Enjoy, and feel free to ask questions. Again, you can get the script <a href="https://github.com/Gnewt/asterisk-dual-cid-spoof">here</a>.</p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2012/07/asterisk-bidirectional-cid-spoofing/#comments" thr:count="5"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2012/07/asterisk-bidirectional-cid-spoofing/feed/atom/" thr:count="5"/>
		<thr:total>5</thr:total>
		</entry>
		<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[Arduino, Circular Linked Lists, and Christmas Lights]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2012/06/christmas-lights-linked-lists/" />
		<id>http://www.gnewt.at/blog/?p=192</id>
		<updated>2013-10-23T04:29:52Z</updated>
		<published>2012-06-27T06:33:40Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Uncategorized" />		<summary type="html"><![CDATA[EDIT: Yes, the linked list solution is not the most efficient one (and in fact could be dangerous if used with much more memory than this when malloc&#8217;d on a small chip like the Arduino). The &#8220;right&#8221; way is using a circular buffer. A sketch utilizing a circular buffer has been added to the github project. [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2012/06/christmas-lights-linked-lists/"><![CDATA[<p><strong>EDIT: </strong>Yes, the linked list solution is not the most efficient one (and in fact could be dangerous if used with much more memory than this when malloc&#8217;d on a small chip like the Arduino). The &#8220;right&#8221; way is using a circular buffer. A sketch utilizing a circular buffer has been added to the github project.</p>
<p>Around two years ago, a fellow by the name of darco posted an article called &#8220;<a href="http://www.deepdarc.com/2010/11/27/hacking-christmas-lights/">Hacking Christmas Lights</a>&#8221; on his blog. He was nice enough to reverse engineer the LED data bus protocol of the GE Color Effects christmas lights, as well as release some code for an ATMel microcontroller. This was of course turned into an <a href="http://www.digitalmisery.com/2011/11/ge-color-effects-arduino-library/">Arduino library</a> soon after.</p>
<p>I had an idea for something to do with these lights: I wanted a network service I could connect to which would pick a random color from a pre-defined list, tell me which color it picked, and then &#8220;push&#8221; that color onto the string of lights. Each time the service was hit, a new color would enter the string of lights. Each other color would move to the next light until it was at the end of the string, where it would &#8220;fall off.&#8221;</p>
<p>I decided to do all the networking and color choosing in a Python script on my laptop, leaving the Arduino with just the task of controlling the lights and storing their colors. The GEColorEffects library would handle the control, so all I needed to do on that end was find a data structure to store the colors in. Usually I would just use an array, but this approach gets ugly when you want to &#8220;move&#8221; each color to the next light. It would involve copying every single color value in the array to the next location before adding the new color.</p>
<pre class="brush: cpp; title: ; notranslate">// colors are 12 bits, so can be stored in a 16-bit type easily
uint16_t lights[NUMLIGHTS]; // populated somewhere else in code
int i;

--snip--

for (i = NUMLIGHTS; i &gt; 1; i--) {
    lights[i-1] = lights[i-2];
}

lights[0] = newcolor;</pre>
<p>The previous code would have to be called every time I wanted to add a new color to the string of lights. It would probably work just fine (meaning sufficiently fast) considering that it&#8217;s only copying 72 bytes, but it feels clunky. I wanted an approach which felt elegant. The thing that came to mind after some shower-aided thinking (all good programming ideas happen in the shower) was a circular linked list. A linked list is a collection of structures, 0r collections of data, with the unique characteristic that each structure contains a pointer to the next one. In a doubly-linked list, each structure contains a pointer to the previous and the next one. In a circular linked list, the last structure points to the first, effectively making it act like a circle. If you were to follow the path forever, you&#8217;d never reach an end.</p>
<p>The nice part of using circular linked lists is that you can just choose where the &#8220;beginning&#8221; is dynamically.</p>
<pre class="brush: cpp; title: ; notranslate">struct RGB
{
    // each color is only 4 bits but stored as an 8-bit type
    uint8_t r;
    uint8_t g;
    uint8_t b;
    struct RGB *next; // pointer to the next RGB structure
};
typedef struct RGB rgb;

rgb *head;

void populate_linked_list()
{
  int i;
  rgb *curr;
  curr = head = (rgb*)malloc(sizeof(rgb)); // allocate first struct as head

  for (i = 0; i &lt; lightCount-1; i++) { // allocate 35 more (36 lights total)
      curr-&gt;r = 15; // they all start out red
      curr-&gt;g = curr-&gt;b = 0;
      curr-&gt;next = (rgb*)malloc(sizeof(rgb));
      curr = curr-&gt;next;
  }
  // and finally, the last struct
  curr-&gt;r = 15;
  curr-&gt;g = curr-&gt;b = 0;
  curr-&gt;next = head; // the &quot;next&quot; after the last, is the first
  curr = head;
}</pre>
<p>The lights are set by iterating through the list and using the GEColorEffects library to set each light to the color represented by each structure. Here comes the fun part. To &#8220;push&#8221; a color onto the set of lights (and move each other color to the next light), all you have to do is write the color values to the current head of the list, and then move the head to point to the next structure. Keep in mind that we&#8217;re pushing colors onto the end of the list, and each color at the very beginning of the list falls off when we do that.</p>
<pre class="brush: cpp; title: ; notranslate">void add_color(uint8_t r, uint8_t g, uint8_t b)
{
  head-&gt;r = r;
  head-&gt;g = g;
  head-&gt;b = b;
  head = head-&gt;next;
}</pre>
<p>We&#8217;ve just moved the beginning/head of the list one light forward (meaning the 2nd color on the string of lights moves to the 1st, 3rd moves to 2nd etc.) and put the data for the new color in the previous location of the head, which is now the very end of the list. The colors of the lights appear to move accordingly.</p>
<p>I put the code on github <a href="https://github.com/Gnewt/circular-christmas-lights/">here</a>. It comes with the Arduino sketch which implements the linked list setup as well as a simple serial interface. Read the README for more info about that.</p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2012/06/christmas-lights-linked-lists/#comments" thr:count="4"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2012/06/christmas-lights-linked-lists/feed/atom/" thr:count="4"/>
		<thr:total>4</thr:total>
		</entry>
		<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[The Energy of Making]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2011/05/the-energy-of-making/" />
		<id>http://www.gnewt.at/blog/?p=183</id>
		<updated>2011-05-25T03:49:57Z</updated>
		<published>2011-05-25T03:35:33Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Uncategorized" />		<summary type="html"><![CDATA[I returned from Maker Faire Bay Area yesterday. The wonderful mix of conference, expo, and fair always fills me with a lot of energy to make things. Just being around people like the members of Noisebridge, the inventors of sugru, Mitch Altman (inventor of the TV-B-Gone), etc., osmotically sparks my creativity and leaves me thinking: [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2011/05/the-energy-of-making/"><![CDATA[<p>I returned from Maker Faire Bay Area yesterday. The wonderful mix of conference, expo, and fair always fills me with a lot of energy to make things. Just being around people like the members of <a href="https://noisebridge.net">Noisebridge</a>, the inventors of <a href="http://sugru.com/">sugru</a>, <a href="http://en.wikipedia.org/wiki/Mitch_Altman">Mitch Altman</a> (inventor of the TV-B-Gone), etc., osmotically sparks my creativity and leaves me thinking: it feels so good to make things. There are people out there who haven&#8217;t made a thing in their life, and they need to be exposed to it.</p>
<p>Cory Doctorow captures what I&#8217;m saying in a quote from his book <em><a href="http://craphound.com/littlebrother/">Little Brother</a></em>:</p>
<blockquote><p>If you&#8217;ve never programmed a computer, you should. There&#8217;s nothing like it in the whole world. When you program a computer, it does <em>exactly</em> what you tell it to do. It&#8217;s like designing a machine &#8212; any machine, like a car, like a faucet, like a gas-hinge for a door &#8212; using math and instructions. It&#8217;s awesome in the truest sense: it can fill you with awe.</p>
<p>A computer is the most complicated machine you&#8217;ll ever use. It&#8217;s made of billions of micro-miniaturized transistors that can be configured to run any program you can imagine. But when you sit down at the keyboard and write a line of code, those transistors do what you tell them to.</p>
<p>Most of us will never build a car. Pretty much none of us will ever create an aviation system. Design a building. Lay out a city.</p></blockquote>
<p>While the quote discusses programming specifically, it explains the brilliance of using the tools available to you to invent new tools. Check out a <a href="http://hackerspaces.org">hackerspace</a> near you, or the <a href="http://makezine.com/">MAKE</a> homepage, or <a href="http://hackaday.com">Hack-A-Day</a>. Look at all the links in this single post: all people who make things and want to help others do the same.</p>
<p>Go make something.</p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2011/05/the-energy-of-making/#comments" thr:count="0"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2011/05/the-energy-of-making/feed/atom/" thr:count="0"/>
		<thr:total>0</thr:total>
		</entry>
		<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[Noisebridge]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2010/05/noisebridge/" />
		<id>http://www.gnewt.at/blog/2010/05/noisebridge/</id>
		<updated>2010-05-23T18:06:48Z</updated>
		<published>2010-05-23T18:06:48Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Uncategorized" />		<summary type="html"><![CDATA[I&#8217;d like to extend a thank you to San Francisco&#8217;s Noisebridge hackerspace for being so hospitable and friendly towards me during my time here. On Friday when I arrived in SFO, I took the BART straight to Noisebridge and hung out there till that night. It was nice to be in an environment where I [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2010/05/noisebridge/"><![CDATA[<p><img style="display:block;margin-right:auto;margin-left:auto;" alt="image" src="http://www.gnewt.at/blog/wp-content/uploads/2010/05/wpid-2010-05-21-19.23.40.jpg" /></p>
<p>I&#8217;d like to extend a thank you to San Francisco&#8217;s <a href="http://noisebridge.net">Noisebridge</a> hackerspace for being so hospitable and friendly towards me during my time here.  On Friday when I arrived in SFO,  I took the BART straight to Noisebridge and hung out there till that night. It was nice to be in an environment where I could work, learn, and talk, despite being a stranger in this city.</p>
<p>I&#8217;ve met a lot of interesting people and was even invited out to dinner that night. San Franciscans really love their lights, I&#8217;ve found. Our crepe restaraunt had fancy fading rainbow lights.</p>
<p>I&#8217;ve included a picture of Noisebridge at a fairly dormant time. </p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2010/05/noisebridge/#comments" thr:count="0"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2010/05/noisebridge/feed/atom/" thr:count="0"/>
		<thr:total>0</thr:total>
		</entry>
		<entry>
		<author>
			<name>Gnewt</name>
						<uri>http://</uri>
					</author>
		<title type="html"><![CDATA[Making Fulgurites]]></title>
		<link rel="alternate" type="text/html" href="http://www.gnewt.at/blog/2010/05/making-fulgurites/" />
		<id>http://www.gnewt.at/blog/?p=122</id>
		<updated>2010-05-19T03:02:33Z</updated>
		<published>2010-05-19T02:34:18Z</published>
		<category scheme="http://www.gnewt.at/blog" term="Uncategorized" />		<summary type="html"><![CDATA[We recently acquired a pole pig at the lab. We bought it off a guy who didn&#8217;t have time for a high voltage hobby any more, and so far we&#8217;ve made a Jacob&#8217;s ladder with it, and used it to make fulgurites. Fulgurites are the figures made by lightning hitting sand (or other melty grainy [&#8230;]]]></summary>
		<content type="html" xml:base="http://www.gnewt.at/blog/2010/05/making-fulgurites/"><![CDATA[<p>We recently acquired a <a href="http://en.wikipedia.org/wiki/Pylon_transformer">pole pig</a> at the lab. We bought it off a guy who didn&#8217;t have time for a high voltage hobby any more, and so far we&#8217;ve made a Jacob&#8217;s ladder with it, and used it to make fulgurites.</p>
<p>Fulgurites are the figures made by lightning hitting sand (or other melty grainy materials). We don&#8217;t have lightning but we can definitely simulate it with the pole pig. We start by putting sand (100lb for $7 at Home Depot) in a terracotta pot. We stick electrodes from the transformer straight into the pot and turn it on. The result comes out like this.</p>
<p><a href="http://www.flickr.com/photos/gnewt/4620012161/"><img class="aligncenter size-full wp-image-124" title="Completed Fulgurites" src="http://www.gnewt.at/blog/wp-content/uploads/2010/05/2010-05-15-18.25.jpg" alt="They're beautiful and fractally." width="320" height="240" /></a></p>
<p>We then epoxy them into nice solid pieces of art. I made a video about the process for my science class.</p>
<p><object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="400" height="300" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="src" value="http://vimeo.com/moogaloop.swf?clip_id=11855445&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=&amp;fullscreen=1" /><embed type="application/x-shockwave-flash" width="400" height="300" src="http://vimeo.com/moogaloop.swf?clip_id=11855445&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=&amp;fullscreen=1" allowscriptaccess="always" allowfullscreen="true"></embed></object></p>
<p><a href="http://vimeo.com/11855445">Fulgurite Production at Hackerbot Labs</a> from <a href="http://vimeo.com/user1020219">Nick Mooney</a> on <a href="http://vimeo.com">Vimeo</a>.</p>
<p>Credits to Pip aka @yoyojedi for helping me out with this. He&#8217;s the fulgurite master and was nice enough to teach me how.</p>
]]></content>
			<link rel="replies" type="text/html" href="http://www.gnewt.at/blog/2010/05/making-fulgurites/#comments" thr:count="2"/>
		<link rel="replies" type="application/atom+xml" href="http://www.gnewt.at/blog/2010/05/making-fulgurites/feed/atom/" thr:count="2"/>
		<thr:total>2</thr:total>
		</entry>
	</feed>

<!-- Dynamic page generated in 0.116 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2017-02-01 13:12:32 -->
