<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Code &#8211; Gnewt&#039;s Blag</title>
	<atom:link href="http://www.gnewt.at/blog/category/code/feed/" rel="self" type="application/rss+xml" />
	<link>http://www.gnewt.at/blog</link>
	<description>She turned me into a Gnewt! I got better...</description>
	<lastBuildDate>Mon, 14 Apr 2014 16:59:55 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.7.2</generator>
	<item>
		<title>BHS Shirt Sales with Django</title>
		<link>http://www.gnewt.at/blog/2014/04/bhs-shirt-sales-with-django/</link>
		<comments>http://www.gnewt.at/blog/2014/04/bhs-shirt-sales-with-django/#comments</comments>
		<pubDate>Mon, 14 Apr 2014 16:59:41 +0000</pubDate>
		<dc:creator><![CDATA[Gnewt]]></dc:creator>
				<category><![CDATA[Code]]></category>

		<guid isPermaLink="false">http://www.gnewt.at/blog/?p=291</guid>
		<description><![CDATA[This is a project I&#8217;ve been working on for the past week or so. It&#8217;s live now, and I wanted to share the codebase. This post is more or less exactly the README from the GitHub repo bhs_sales, so head there if you want to get right to it. Intro The BHS Class of 2014 [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>This is a project I&#8217;ve been working on for the past week or so. It&#8217;s live now, and I wanted to share the codebase. This post is more or less exactly the README from the <a href="https://github.com/Gnewt/bhs_sales">GitHub repo bhs_sales</a>, so head there if you want to get right to it.</p>
<h2>Intro</h2>
<p>The BHS Class of 2014 needs some money for prom. We came up with the idea of selling senior shirts as a fundraiser, but the process for organizing an order for ~300 people is incredibly complex and comes with the headaches of having to lend money to make an order, collecting money afterward, over-ordering, etc.</p>
<p>This is our solution: a Stripe-based marketplace to preorder shirts. This lets us record the name/size/selection of everyone who wants a shirt, and then aggregate that data later. Payments are processed through Stripe.</p>
<h2>Technical Stuff</h2>
<p>This is a Django project. It currently only has one application, &#8220;shirts.&#8221; Data is stored by default in SQLite, but that can be changed easily. Database migrations are handled through South.</p>
<p>I have included some deployment scripts, namely:</p>
<ul>
<li><code>Makefile</code>
<ul>
<li>Provides automated deployment, but will require changing of paths</li>
</ul>
</li>
<li><code>hup_bhssales</code>
<ul>
<li>Used in my git post-receive hook to restart the server process automatically when I push new changes to production</li>
</ul>
</li>
<li><code>bin/gunicorn_start</code>
<ul>
<li>The script called by supervisord to start gunicorn &#8212; will also require changing of paths for custom deployment</li>
</ul>
</li>
</ul>
<p>Supervisor keeps a gunicorn instance running with a socket in /tmp. I have set up nginx to proxy_pass to that socket, more or less just like any other Django project.</p>
<h2>Architecture</h2>
<p>There are only two models. 1. <code>StoreItem</code> contains a name/description/summary/price of a certain item 2. <code>Order</code> contains the name of the customer, a timestamp, the purchase price (in case the price in the future changes), and the Stripe ID of the charge. The Stripe ID is optional &#8212; I&#8217;ve allowed a separate &#8220;in person&#8221; payment type.</p>
<p>When the order form is submitted, <code>/charge</code> will use the Stripe Checkout token to attempt to make the charge through Stripe. If it&#8217;s successful, an Order instance will be saved and the user redirected to a confirmation page. A public list of all orders is included.</p>
<p>The sizes are stored as a constant in <code>shirts/models.py</code>. I&#8217;m not sure this is the best way to do it.</p>
<h2>Configuration</h2>
<p>I have included my Dev configuration. I manage configurations using <a href="http://django-configurations.readthedocs.org/en/latest/">django-configurations</a>. You&#8217;ll notice the end of <code>settings.py</code> tries to import all from <code>local_settings.py</code>. You&#8217;ll need to create a <code>local_settings.py</code> in the same format as <code>settings.py</code>, containing a:</p>
<pre><code>class Production(Configuration):
</code></pre>
<p>Put your live Stripe keys in that configuration, without committing it to Git.</p>
<p>Also, run this in a venv. A <code>requirements.txt</code> is included.</p>
]]></content:encoded>
			<wfw:commentRss>http://www.gnewt.at/blog/2014/04/bhs-shirt-sales-with-django/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>Weekend Project: Web-controlled Christmas Lights with Node.js, Arduino, and Raspberry Pi</title>
		<link>http://www.gnewt.at/blog/2013/09/christmas-lights-with-node-js-arduino-raspberry-pi/</link>
		<comments>http://www.gnewt.at/blog/2013/09/christmas-lights-with-node-js-arduino-raspberry-pi/#comments</comments>
		<pubDate>Sun, 15 Sep 2013 20:03:38 +0000</pubDate>
		<dc:creator><![CDATA[Gnewt]]></dc:creator>
				<category><![CDATA[Code]]></category>
		<category><![CDATA[arduino]]></category>
		<category><![CDATA[christmas lights]]></category>
		<category><![CDATA[node.js]]></category>
		<category><![CDATA[raspberry pi]]></category>

		<guid isPermaLink="false">http://www.gnewt.at/blog/?p=250</guid>
		<description><![CDATA[This is my Node.js &#8220;hello world.&#8221; It&#8217;s a weekend project that allows you to control GE Color Effects lights over the internet through the use of a Raspberry Pi (running nginx and a Node.js application) connected to an Arduino. Like I say in the video, I think it may be possible to control the data [&#8230;]]]></description>
				<content:encoded><![CDATA[<p><a href="http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights.jpg"><img class="aligncenter size-medium wp-image-255" alt="Christmas Lights" src="http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights-300x199.jpg" width="300" height="199" srcset="http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights-300x199.jpg 300w, http://www.gnewt.at/blog/wp-content/uploads/2013/09/christmaslights-1024x680.jpg 1024w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>This is my Node.js &#8220;hello world.&#8221; It&#8217;s a weekend project that allows you to control GE Color Effects lights over the internet through the use of a Raspberry Pi (running nginx and a Node.js application) connected to an Arduino. Like I say in the video, I think it may be possible to control the data line of these lights directly from the Raspberry Pi&#8217;s GPIO pins, but I <a href="https://github.com/Gnewt/circular-christmas-lights">already wrote an Arduino library</a> to handle that and it works nicely.</p>
<p><iframe width="500" height="375" src="http://www.youtube.com/embed/NFm5xcVaPGo?feature=oembed" frameborder="0" allowfullscreen></iframe></p>
<h2>Tech Stuff</h2>
<p>The setup is fairly simple. The Raspberry Pi runs a frontend with my webserver of choice, nginx. It serves up a static page on / and proxies to my Node.js application on /api. Post data sent to /api is decoded by the Node application and matched with a hex value (assuming the color sent was valid). This hex value is then packed into the two-byte serial format I developed for my Arduino library, and sent over serial to the Arduino. Internally the Arduino uses a data structure called a <a href="http://en.wikipedia.org/wiki/Circular_buffer">circular buffer</a>. Circular buffers are especially cool for this usage, because when I &#8216;push&#8217; a light onto the string of lights, every single light needs to be updated (as each color is &#8216;moving&#8217; down the line). With a circular buffer, the data structure remains a constant size, and all that&#8217;s required to update it is to write a new value at the &#8216;head&#8217; location and then increment the location of the head. More specifics about how this works can be found in the linked Wikipedia article as well as the source code for the aforementioned Arduino library.</p>
<p>I had a lot of fun with this project. One thing I really like about Node.js is how simple it makes creating APIs that can do Really Cool Things. Using just the JavaScript environment available in my web browser, I can package the color data in the format Node needs it, and let Node handle the rest. Node.js is not for everything, but the ease of communication between browser and application makes it a joy to work with.</p>
<h2>Do It Yourself</h2>
<p>Get a Raspberry Pi set up with Node.js installed, and an Arduino with the sketch linked below flashed to it. To flash the Arduino, you need the <a href="http://www.digitalmisery.com/2011/11/ge-color-effects-arduino-library/">GEColorEffects library</a> as a dependency.  Connection to the lights themselves is outside of the scope of this post, but more info can be found in <a href="http://www.deepdarc.com/2010/11/27/hacking-christmas-lights/">darco&#8217;s original post</a>. Clone the nodejs-christmas-lights git repository onto the Raspberry Pi. Ensure that the Arduino manifests as a serial port (usually /dev/ttyACM0) on the RPi, and chmod it to be accessible by your user. A simple &#8216;chmod 777 /dev/ttyACM0&#8217; should do, since (hopefully&#8230;) your Raspberry Pi isn&#8217;t a production box.</p>
<p>Set up nginx on your Raspberry Pi, and put the contents of the nodejs-christmas-lights repository&#8217;s www folder in your webroot. Again, this is more or less outside the scope of this post, but the following config should act as a starting point. Important to note is that the /api path must forward to the host/port of your Node.js application.</p>
<pre>server {
    listen 80;
    server_name lights;

    root /var/www/vhosts/lights/htdocs;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    location /api {
        proxy_pass http://localhost:8080;
    }
}</pre>
<p>If all is set up correctly, navigate to the Raspberry Pi in your browser, choose a color, and hit the &#8216;Go!&#8217; button.</p>
<h2>Resources</h2>
<ul>
<li>Circular Buffer Christmas Lights (Arduino sketch): <a href="https://github.com/Gnewt/circular-christmas-lights">Github</a></li>
<li>GE Color Effects library: <a href="http://www.digitalmisery.com/2011/11/ge-color-effects-arduino-library/">GE Color Effects Arduino Library</a></li>
<li>Node.js Christmas Lights: <a href="https://github.com/Gnewt/nodejs-christmas-lights">Github</a></li>
<li>Darco&#8217;s original post: <a href="http://www.deepdarc.com/2010/11/27/hacking-christmas-lights/">Hacking Christmas Lights</a></li>
</ul>
<p>Feel free to ask questions in the comments. If you do something cool with this code, I&#8217;d love to hear about it!</p>
]]></content:encoded>
			<wfw:commentRss>http://www.gnewt.at/blog/2013/09/christmas-lights-with-node-js-arduino-raspberry-pi/feed/</wfw:commentRss>
		<slash:comments>5</slash:comments>
		</item>
		<item>
		<title>Publishing Data to Redis with Django Signals</title>
		<link>http://www.gnewt.at/blog/2013/08/publishing-data-to-redis-with-django-signals/</link>
		<comments>http://www.gnewt.at/blog/2013/08/publishing-data-to-redis-with-django-signals/#respond</comments>
		<pubDate>Mon, 19 Aug 2013 04:37:29 +0000</pubDate>
		<dc:creator><![CDATA[Gnewt]]></dc:creator>
				<category><![CDATA[Code]]></category>

		<guid isPermaLink="false">http://www.gnewt.at/blog/?p=244</guid>
		<description><![CDATA[Just something I found and thought was kind of cool. I&#8217;m currently working on a project that uses Django for its frontend, but eventually passes the user to a JavaScript frontend that talks to the Node.js / Redis backend with Socket.IO. I needed a way to store data in Redis whenever a specific Django model [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>Just something I found and thought was kind of cool. I&#8217;m currently working on a project that uses Django for its frontend, but eventually passes the user to a JavaScript frontend that talks to the Node.js / Redis backend with Socket.IO. I needed a way to store data in Redis whenever a specific Django model was saved. I looked up &#8216;Django + redis&#8217; beforehand, but the existing projects seem to be mostly cache-oriented, and as far as I know Django doesn&#8217;t have a standard adapter for Redis. No worries &#8212; it&#8217;s all Python!</p>
<p>Django signals let you execute functions whenever a signal is emitted, but specifically in my case, when a model is saved. You can put your signals code anywhere, but I like to make a &#8216;signals.py&#8217; in the app directory and then just add the line &#8216;import signals&#8217; to the app&#8217;s __init__.py. I subscribed to the Django model saved and model deleted signals with functions that connect to Redis and add some of the relevant data to a hash. Hashes in Redis are very much like dicts in Python, and <a href="https://github.com/andymccurdy/redis-py">Andy McCurdy&#8217;s redis-py library</a> allows you to pass dicts directly to the hmset function.</p>
<p>Here&#8217;s the relevant code (adapted for the example) in signals.py:</p>
<pre class="brush: python; title: ; notranslate">import redis
from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver
from yourapp.models import YourModel

@receiver(post_save, sender=YourModel, dispatch_uid=&quot;yourmodel_create&quot;)
def addYourModelToRedis(sender, instance, **kwargs):
	r = redis.StrictRedis(host='localhost', port=6379, db=0)
	yourmodel_dict = {
		'uid': instance.user.id,
		'number1': instance.number_1,
		'number2': instance.number_2,
		'status': instance.status
	}
	r.hmset('yourmodel:' + instance.uniqueKey, yourmodel_dict)

@receiver(post_delete, sender=YourModel, dispatch_uid=&quot;yourmodel_delete&quot;)
def removeYourModelFromRedis(sender, instance, **kwargs):
	r = redis.StrictRedis(host='localhost', port=6379, db=0)
	r.delete('yourmodel:' + instance.uniqueKey)</pre>
<p>The &#8220;dispatch_uid&#8221; parameter passed to the receiver decorator is intended to keep the signal from being acted upon more than once per save/deletion of a model. All the Django documentation says is to use a unique string; they don&#8217;t recommend that you use a specific format and it doesn&#8217;t seem to matter as long as it&#8217;s unique. Another thing to note is that the &#8216;instance&#8217; parameter for my handler functions is specific to the post_save and post_delete signals. In general signal handlers are expected to take &#8220;sender&#8221; and &#8220;**kwargs.&#8221; However it&#8217;s safe to extract the &#8216;instance&#8217; variable from **kwargs in the function definition when only being used for these specific signals. More information about signals and handling signals can be found in the <a href="https://docs.djangoproject.com/en/dev/topics/signals/">Django documentation.</a></p>
]]></content:encoded>
			<wfw:commentRss>http://www.gnewt.at/blog/2013/08/publishing-data-to-redis-with-django-signals/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>

<!-- Dynamic page generated in 0.059 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2017-02-01 13:12:35 -->
